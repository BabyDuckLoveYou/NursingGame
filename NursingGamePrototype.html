<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÄ‡∏Å‡∏°‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏â‡∏µ‡∏î‡∏¢‡∏≤ (Prototype)</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background-color: #f0f8ff;
            color: #333;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }

        .game-container {
            background-color: #fff;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            padding: 30px;
            width: 90%;
            max-width: 750px;
            text-align: center;
            position: relative;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 25px;
            font-size: 2em;
        }

        .patient-info {
            background-color: #e0f7fa;
            border-left: 5px solid #00bcd4;
            padding: 15px;
            margin-bottom: 25px;
            border-radius: 8px;
            font-size: 1.1em;
            line-height: 1.6;
        }

        .patient-info strong {
            color: #00796b;
        }

        .medicine-options, .action-buttons, .injection-method-options {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin-bottom: 25px;
        }

        .medicine-button, .action-button, .injection-method-button {
            background-color: #4CAF50;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .medicine-button:hover, .action-button:hover, .injection-method-button:hover {
            background-color: #45a049;
            transform: translateY(-2px);
        }

        .medicine-button:active, .action-button:active, .injection-method-button:active {
            transform: translateY(0);
        }

        /* ‡∏™‡∏µ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥ */
        .action-button.clean { background-color: #607d8b; }
        .action-button.clean:hover { background-color: #455a64; }
        .action-button.prepare { background-color: #ff9800; }
        .action-button.prepare:hover { background-color: #e68a00; }
        .action-button.inject { background-color: #2196F3; }
        .action-button.inject:hover { background-color: #0b7dda; }
        .action-button.apply { background-color: #8bc34a; } /* ‡∏¢‡∏≤‡∏ó‡∏≤ */
        .action-button.apply:hover { background-color: #689f38; }
        .action-button.administer { background-color: #ff5722; } /* ‡∏¢‡∏≤‡πÄ‡∏°‡πá‡∏î/‡∏ô‡πâ‡∏≥ */
        .action-button.administer:hover { background-color: #e64a19; }

        /* ‡∏™‡∏µ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏â‡∏µ‡∏î */
        .injection-method-button.intramuscular { background-color: #9c27b0; }
        .injection-method-button.intramuscular:hover { background-color: #7b1fa2; }
        .injection-method-button.intravenous { background-color: #f44336; }
        .injection-method-button.intravenous:hover { background-color: #d32f2f; }
        .injection-method-button.subcutaneous { background-color: #009688; }
        .injection-method-button.subcutaneous:hover { background-color: #00796b; }
        .injection-method-button.intradermal { background-color: #795548; }
        .injection-method-button.intradermal:hover { background-color: #5d4037; }


        #feedback {
            margin-top: 25px;
            padding: 15px;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .correct {
            background-color: #e8f5e9;
            color: #2e7d32;
            border: 1px solid #a5d6a7;
        }

        .incorrect {
            background-color: #ffebee;
            color: #c62828;
            border: 1px solid #ef9a9a;
        }

        #score-display {
            font-size: 1.3em;
            font-weight: bold;
            margin-top: 20px;
            color: #1a237e;
            text-align: center;
        }

        .next-patient-button-container {
            width: 100%;
            display: flex;
            justify-content: flex-end;
            margin-top: 20px;
        }

        .next-patient-button {
            background-color: #007bff;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s ease;
            margin-left: auto;
            margin-right: 0;
        }

        .next-patient-button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>üè• ‡πÄ‡∏Å‡∏°‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏â‡∏µ‡∏î‡∏¢‡∏≤ üíâ</h1>
        <div class="patient-info">
            <p><strong>‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏°‡∏µ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£:</strong> <span id="patient-symptom"></span></p>
        </div>

        <div class="medicine-options" id="medicine-options">
        </div>

        <div class="action-buttons" id="action-buttons" style="display: none;">
        </div>

        <div class="injection-method-options" id="injection-method-options" style="display: none;">
        </div>

        <div id="feedback">
        </div>

        <div class="next-patient-button-container">
            <button class="next-patient-button" id="next-patient-btn" style="display: none;">‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏Ñ‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</button>
        </div>

        <div id="score-display">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: 0</div>
    </div>

    <script>
        // --- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÅ‡∏•‡∏∞‡∏î‡∏∂‡∏á Element ‡∏à‡∏≤‡∏Å HTML ---
        const patientSymptomElem = document.getElementById('patient-symptom');
        const medicineOptionsElem = document.getElementById('medicine-options');
        const actionButtonsElem = document.getElementById('action-buttons');
        const injectionMethodOptionsElem = document.getElementById('injection-method-options');
        const feedbackElem = document.getElementById('feedback');
        const scoreDisplayElem = document.getElementById('score-display');
        const nextPatientBtn = document.getElementById('next-patient-btn');

        let score = 0;
        let currentPatient = {};
        let currentStepIndex = 0; // 0: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏¢‡∏≤, 1: ‡∏ó‡∏≥‡∏ï‡∏≤‡∏°‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏¢‡∏≤

        // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏¢‡∏≤‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó
        const correctProcedures = {
            'injection': [
                { id: 'cleanArea', text: '‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏ö‡∏£‡∏¥‡πÄ‡∏ß‡∏ì‡∏ó‡∏µ‡πà‡∏â‡∏µ‡∏î', class: 'clean' },
                { id: 'prepareMedicine', text: '‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏¢‡∏≤', class: 'prepare' },
                { id: 'injectMedicine', text: '‡∏â‡∏µ‡∏î‡∏¢‡∏≤', class: 'inject' },
                { id: 'selectInjectionMethod', text: '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏â‡∏µ‡∏î', class: '' } // ‡∏ô‡∏µ‡πà‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏õ‡∏∏‡πà‡∏° ‡πÅ‡∏ï‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏Å renderInjectionMethodButtons
            ],
            'topical': [ // ‡∏¢‡∏≤‡∏ó‡∏≤
                { id: 'cleanArea', text: '‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏ö‡∏£‡∏¥‡πÄ‡∏ß‡∏ì‡∏ó‡∏µ‡πà‡∏ó‡∏≤', class: 'clean' },
                { id: 'applyMedicine', text: '‡∏ó‡∏≤‡∏¢‡∏≤', class: 'apply' }
            ],
            'oral': [ // ‡∏¢‡∏≤‡πÄ‡∏°‡πá‡∏î/‡∏ô‡πâ‡∏≥
                { id: 'prepareMedicine', text: '‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏¢‡∏≤', class: 'prepare' },
                { id: 'administerMedicine', text: '‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤', class: 'administer' }
            ]
        };

        let currentProcedure = []; // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô

        // --- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡πÅ‡∏•‡∏∞‡∏¢‡∏≤ ---
        // ‡πÄ‡∏û‡∏¥‡πà‡∏° 'medicineType' (injection, topical, oral) ‡πÅ‡∏•‡∏∞ 'correctInjectionMethod' (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏¢‡∏≤‡∏â‡∏µ‡∏î‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)
        const patients = [
            { symptom: "‡πÑ‡∏Ç‡πâ‡∏™‡∏π‡∏á", correctMedicine: "‡∏¢‡∏≤‡∏•‡∏î‡πÑ‡∏Ç‡πâ‡∏â‡∏µ‡∏î", medicineType: "injection", correctInjectionMethod: "intramuscular" },
            { symptom: "‡∏õ‡∏ß‡∏î‡∏´‡∏±‡∏ß‡πÑ‡∏°‡πÄ‡∏Å‡∏£‡∏ô", correctMedicine: "‡∏¢‡∏≤‡πÑ‡∏°‡πÄ‡∏Å‡∏£‡∏ô‡∏â‡∏µ‡∏î", medicineType: "injection", correctInjectionMethod: "subcutaneous" },
            { symptom: "‡∏ú‡∏∑‡πà‡∏ô‡∏Ñ‡∏±‡∏ô‡∏à‡∏≤‡∏Å‡∏†‡∏π‡∏°‡∏¥‡πÅ‡∏û‡πâ", correctMedicine: "‡∏¢‡∏≤‡πÅ‡∏Å‡πâ‡πÅ‡∏û‡πâ‡∏ä‡∏ô‡∏¥‡∏î‡∏ó‡∏≤", medicineType: "topical" },
            { symptom: "‡∏ó‡πâ‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á", correctMedicine: "‡∏¢‡∏≤‡πÅ‡∏Å‡πâ‡∏ó‡πâ‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏â‡∏µ‡∏î", medicineType: "injection", correctInjectionMethod: "intravenous" },
            { symptom: "‡πÑ‡∏≠‡πÅ‡∏´‡πâ‡∏á ‡πÄ‡∏à‡πá‡∏ö‡∏Ñ‡∏≠", correctMedicine: "‡∏¢‡∏≤‡πÅ‡∏Å‡πâ‡πÑ‡∏≠‡∏ä‡∏ô‡∏¥‡∏î‡∏ô‡πâ‡∏≥", medicineType: "oral" },
            { symptom: "‡∏õ‡∏ß‡∏î‡∏ü‡∏±‡∏ô", correctMedicine: "‡∏¢‡∏≤‡πÅ‡∏Å‡πâ‡∏õ‡∏ß‡∏î‡∏ü‡∏±‡∏ô‡∏ä‡∏ô‡∏¥‡∏î‡πÄ‡∏°‡πá‡∏î", medicineType: "oral" },
            { symptom: "‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô‡∏´‡∏±‡∏ß ‡∏Ñ‡∏•‡∏∑‡πà‡∏ô‡πÑ‡∏™‡πâ", correctMedicine: "‡∏¢‡∏≤‡πÅ‡∏Å‡πâ‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô‡∏´‡∏±‡∏ß‡∏â‡∏µ‡∏î", medicineType: "injection", correctInjectionMethod: "intravenous" },
            { symptom: "‡∏õ‡∏ß‡∏î‡∏Å‡∏•‡πâ‡∏≤‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠", correctMedicine: "‡∏¢‡∏≤‡∏Ñ‡∏•‡∏≤‡∏¢‡∏Å‡∏•‡πâ‡∏≤‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏ä‡∏ô‡∏¥‡∏î‡∏ó‡∏≤", medicineType: "topical" },
            { symptom: "‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡πâ‡∏≠‡∏≤‡∏´‡∏≤‡∏£", correctMedicine: "‡∏¢‡∏≤‡πÅ‡∏Å‡πâ‡πÅ‡∏û‡πâ‡∏â‡∏µ‡∏î", medicineType: "injection", correctInjectionMethod: "intradermal" },
            { symptom: "‡πÑ‡∏Ç‡πâ‡∏´‡∏ß‡∏±‡∏î‡πÉ‡∏´‡∏ç‡πà", correctMedicine: "‡∏¢‡∏≤‡∏•‡∏î‡πÑ‡∏Ç‡πâ‡∏ä‡∏ô‡∏¥‡∏î‡πÄ‡∏°‡πá‡∏î", medicineType: "oral" },
            { symptom: "‡∏õ‡∏ß‡∏î‡∏ó‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô", correctMedicine: "‡∏¢‡∏≤‡πÅ‡∏Å‡πâ‡∏õ‡∏ß‡∏î‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ä‡∏ô‡∏¥‡∏î‡πÄ‡∏°‡πá‡∏î", medicineType: "oral" },
            { symptom: "‡∏ï‡∏≤‡∏≠‡∏±‡∏Å‡πÄ‡∏™‡∏ö", correctMedicine: "‡∏¢‡∏≤‡∏´‡∏¢‡∏≠‡∏î‡∏ï‡∏≤‡∏õ‡∏è‡∏¥‡∏ä‡∏µ‡∏ß‡∏ô‡∏∞", medicineType: "topical" }, // ‡πÉ‡∏ä‡πâ topical ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏¢‡∏≠‡∏î‡∏ï‡∏≤
            { symptom: "‡πÅ‡∏ú‡∏•‡∏ñ‡∏•‡∏≠‡∏Å", correctMedicine: "‡∏ô‡πâ‡∏≥‡∏¢‡∏≤‡∏Ü‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏ä‡∏ô‡∏¥‡∏î‡∏ó‡∏≤", medicineType: "topical" },
            { symptom: "‡∏ô‡∏≠‡∏ô‡πÑ‡∏°‡πà‡∏´‡∏•‡∏±‡∏ö", correctMedicine: "‡∏¢‡∏≤‡∏ô‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏ö‡∏≠‡πà‡∏≠‡∏ô‡πÜ‡∏ä‡∏ô‡∏¥‡∏î‡πÄ‡∏°‡πá‡∏î", medicineType: "oral" },
            { symptom: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡πÇ‡∏•‡∏´‡∏¥‡∏ï‡∏™‡∏π‡∏á", correctMedicine: "‡∏¢‡∏≤‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡∏ä‡∏ô‡∏¥‡∏î‡πÄ‡∏°‡πá‡∏î", medicineType: "oral" },
            { symptom: "‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô (‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡∏™‡∏π‡∏á)", correctMedicine: "‡∏¢‡∏≤‡∏≠‡∏¥‡∏ô‡∏ã‡∏π‡∏•‡∏¥‡∏ô", medicineType: "injection", correctInjectionMethod: "subcutaneous" },
            { symptom: "‡∏Å‡∏£‡∏∞‡πÄ‡∏û‡∏≤‡∏∞‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏≠‡∏±‡∏Å‡πÄ‡∏™‡∏ö", correctMedicine: "‡∏¢‡∏≤‡πÄ‡∏Ñ‡∏•‡∏∑‡∏≠‡∏ö‡∏Å‡∏£‡∏∞‡πÄ‡∏û‡∏≤‡∏∞‡∏ä‡∏ô‡∏¥‡∏î‡∏ô‡πâ‡∏≥", medicineType: "oral" },
            { symptom: "‡∏õ‡∏ß‡∏î‡∏Ç‡πâ‡∏≠‡πÄ‡∏Ç‡πà‡∏≤", correctMedicine: "‡∏¢‡∏≤‡πÅ‡∏Å‡πâ‡∏õ‡∏ß‡∏î‡∏Ç‡πâ‡∏≠‡∏ä‡∏ô‡∏¥‡∏î‡∏ó‡∏≤", medicineType: "topical" },
            { symptom: "‡∏ï‡∏¥‡∏î‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏ó‡∏≤‡∏á‡πÄ‡∏î‡∏¥‡∏ô‡∏õ‡∏±‡∏™‡∏™‡∏≤‡∏ß‡∏∞", correctMedicine: "‡∏¢‡∏≤‡∏õ‡∏è‡∏¥‡∏ä‡∏µ‡∏ß‡∏ô‡∏∞‡∏ä‡∏ô‡∏¥‡∏î‡πÄ‡∏°‡πá‡∏î", medicineType: "oral" },
            { symptom: "‡πÄ‡∏à‡πá‡∏ö‡∏Ñ‡∏≠‡∏à‡∏≤‡∏Å‡∏ó‡∏≠‡∏ô‡∏ã‡∏¥‡∏•‡∏≠‡∏±‡∏Å‡πÄ‡∏™‡∏ö", correctMedicine: "‡∏¢‡∏≤‡∏Ü‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏ä‡∏ô‡∏¥‡∏î‡πÄ‡∏°‡πá‡∏î", medicineType: "oral" }
        ];

        // ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÉ‡∏ô‡πÄ‡∏Å‡∏° (‡∏£‡∏ß‡∏°‡∏¢‡∏≤‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏¢‡∏≤‡∏´‡∏•‡∏≠‡∏Å) ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏∞‡∏ö‡∏∏‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó
        const allMedicines = [
            { name: "‡∏¢‡∏≤‡∏•‡∏î‡πÑ‡∏Ç‡πâ‡∏â‡∏µ‡∏î", type: "injection" },
            { name: "‡∏¢‡∏≤‡πÑ‡∏°‡πÄ‡∏Å‡∏£‡∏ô‡∏â‡∏µ‡∏î", type: "injection" },
            { name: "‡∏¢‡∏≤‡πÅ‡∏Å‡πâ‡πÅ‡∏û‡πâ‡∏ä‡∏ô‡∏¥‡∏î‡∏ó‡∏≤", type: "topical" },
            { name: "‡∏¢‡∏≤‡πÅ‡∏Å‡πâ‡∏ó‡πâ‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏â‡∏µ‡∏î", type: "injection" },
            { name: "‡∏¢‡∏≤‡πÅ‡∏Å‡πâ‡πÑ‡∏≠‡∏ä‡∏ô‡∏¥‡∏î‡∏ô‡πâ‡∏≥", type: "oral" },
            { name: "‡∏¢‡∏≤‡πÅ‡∏Å‡πâ‡∏õ‡∏ß‡∏î‡∏ü‡∏±‡∏ô‡∏ä‡∏ô‡∏¥‡∏î‡πÄ‡∏°‡πá‡∏î", type: "oral" },
            { name: "‡∏¢‡∏≤‡πÅ‡∏Å‡πâ‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô‡∏´‡∏±‡∏ß‡∏â‡∏µ‡∏î", type: "injection" },
            { name: "‡∏¢‡∏≤‡∏Ñ‡∏•‡∏≤‡∏¢‡∏Å‡∏•‡πâ‡∏≤‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏ä‡∏ô‡∏¥‡∏î‡∏ó‡∏≤", type: "topical" },
            { name: "‡∏¢‡∏≤‡πÅ‡∏Å‡πâ‡πÅ‡∏û‡πâ‡∏â‡∏µ‡∏î", type: "injection" },
            { name: "‡∏¢‡∏≤‡∏•‡∏î‡πÑ‡∏Ç‡πâ‡∏ä‡∏ô‡∏¥‡∏î‡πÄ‡∏°‡πá‡∏î", type: "oral" },
            { name: "‡∏¢‡∏≤‡πÅ‡∏Å‡πâ‡∏õ‡∏ß‡∏î‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ä‡∏ô‡∏¥‡∏î‡πÄ‡∏°‡πá‡∏î", type: "oral" },
            { name: "‡∏¢‡∏≤‡∏´‡∏¢‡∏≠‡∏î‡∏ï‡∏≤‡∏õ‡∏è‡∏¥‡∏ä‡∏µ‡∏ß‡∏ô‡∏∞", type: "topical" },
            { name: "‡∏ô‡πâ‡∏≥‡∏¢‡∏≤‡∏Ü‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏ä‡∏ô‡∏¥‡∏î‡∏ó‡∏≤", type: "topical" },
            { name: "‡∏¢‡∏≤‡∏ô‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏ö‡∏≠‡πà‡∏≠‡∏ô‡πÜ‡∏ä‡∏ô‡∏¥‡∏î‡πÄ‡∏°‡πá‡∏î", type: "oral" },
            { name: "‡∏¢‡∏≤‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡∏ä‡∏ô‡∏¥‡∏î‡πÄ‡∏°‡πá‡∏î", type: "oral" },
            { name: "‡∏¢‡∏≤‡∏≠‡∏¥‡∏ô‡∏ã‡∏π‡∏•‡∏¥‡∏ô", type: "injection" },
            { name: "‡∏¢‡∏≤‡πÄ‡∏Ñ‡∏•‡∏∑‡∏≠‡∏ö‡∏Å‡∏£‡∏∞‡πÄ‡∏û‡∏≤‡∏∞‡∏ä‡∏ô‡∏¥‡∏î‡∏ô‡πâ‡∏≥", type: "oral" },
            { name: "‡∏¢‡∏≤‡πÅ‡∏Å‡πâ‡∏õ‡∏ß‡∏î‡∏Ç‡πâ‡∏≠‡∏ä‡∏ô‡∏¥‡∏î‡∏ó‡∏≤", type: "topical" },
            { name: "‡∏¢‡∏≤‡∏õ‡∏è‡∏¥‡∏ä‡∏µ‡∏ß‡∏ô‡∏∞‡∏ä‡∏ô‡∏¥‡∏î‡πÄ‡∏°‡πá‡∏î", type: "oral" },
            { name: "‡∏¢‡∏≤‡∏Ü‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏ä‡∏ô‡∏¥‡∏î‡πÄ‡∏°‡πá‡∏î", type: "oral" },
            { name: "‡∏¢‡∏≤‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏ä‡∏ô‡∏¥‡∏î‡πÄ‡∏°‡πá‡∏î", type: "oral" },
            { name: "‡∏ß‡∏¥‡∏ï‡∏≤‡∏°‡∏¥‡∏ô‡∏ã‡∏µ‡∏ä‡∏ô‡∏¥‡∏î‡πÄ‡∏°‡πá‡∏î", type: "oral" },
            { name: "‡∏¢‡∏≤‡∏ñ‡πà‡∏≤‡∏¢‡∏û‡∏¢‡∏≤‡∏ò‡∏¥‡∏ä‡∏ô‡∏¥‡∏î‡πÄ‡∏°‡πá‡∏î", type: "oral" },
            { name: "‡∏¢‡∏≤‡πÅ‡∏Å‡πâ‡∏õ‡∏ß‡∏î‡∏ó‡πâ‡∏≠‡∏á‡∏ä‡∏ô‡∏¥‡∏î‡πÄ‡∏°‡πá‡∏î", type: "oral" },
            { name: "‡∏¢‡∏≤‡πÅ‡∏Å‡πâ‡∏õ‡∏ß‡∏î‡∏ä‡∏ô‡∏¥‡∏î‡∏ó‡∏≤", type: "topical" }
        ];

        // --- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 3: ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠ (Helper Functions) ---
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï getActionText ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°‡∏ó‡∏∏‡∏Å‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏â‡∏µ‡∏î
        function getActionText(actionId) {
            switch (actionId) {
                case 'cleanArea': return '‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏ö‡∏£‡∏¥‡πÄ‡∏ß‡∏ì';
                case 'prepareMedicine': return '‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏¢‡∏≤';
                case 'injectMedicine': return '‡∏â‡∏µ‡∏î‡∏¢‡∏≤';
                case 'applyMedicine': return '‡∏ó‡∏≤‡∏¢‡∏≤';
                case 'administerMedicine': return '‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏ó‡∏≤‡∏ô‡∏¢‡∏≤';
                case 'intramuscular': return '‡∏â‡∏µ‡∏î‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏•‡πâ‡∏≤‡∏° (IM)';
                case 'intravenous': return '‡∏â‡∏µ‡∏î‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏™‡πâ‡∏ô (IV)';
                case 'subcutaneous': return '‡∏â‡∏µ‡∏î‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ï‡πâ‡∏ú‡∏¥‡∏ß‡∏´‡∏ô‡∏±‡∏á (SC)';
                case 'intradermal': return '‡∏â‡∏µ‡∏î‡πÄ‡∏Ç‡πâ‡∏≤‡∏ú‡∏¥‡∏ß‡∏´‡∏ô‡∏±‡∏á (ID)';
                default: return '';
            }
        }

        function handleWrongAttempt(message, deduction) {
            feedbackElem.textContent = `üö® ${message}`;
            feedbackElem.classList.remove('correct');
            feedbackElem.classList.add('incorrect');
            score = Math.max(0, score - deduction);
            scoreDisplayElem.textContent = `‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: ${score}`;
            medicineOptionsElem.style.display = 'none';
            actionButtonsElem.style.display = 'none';
            injectionMethodOptionsElem.style.display = 'none';
            nextPatientBtn.style.display = 'block';
        }

        // --- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 4: ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° Flow ‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡∏° ---
        function startGame() {
            score = 0;
            scoreDisplayElem.textContent = `‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: ${score}`;
            loadNewPatient();
        }

        function loadNewPatient() {
            feedbackElem.textContent = '';
            feedbackElem.className = '';
            nextPatientBtn.style.display = 'none';
            actionButtonsElem.style.display = 'none';
            actionButtonsElem.innerHTML = '';
            injectionMethodOptionsElem.style.display = 'none';
            injectionMethodOptionsElem.innerHTML = '';
            
            medicineOptionsElem.style.pointerEvents = 'auto';
            medicineOptionsElem.style.display = 'flex';
            currentStepIndex = 0;

            const randomIndex = Math.floor(Math.random() * patients.length);
            currentPatient = patients[randomIndex];

            patientSymptomElem.textContent = currentPatient.symptom;
            feedbackElem.textContent = `‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏¢‡∏≤‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏≤‡∏Å‡∏≤‡∏£ "${currentPatient.symptom}"`;

            let chosenMedicines = new Set();
            chosenMedicines.add(currentPatient.correctMedicine);

            while (chosenMedicines.size < 4) {
                const randomMed = allMedicines[Math.floor(Math.random() * allMedicines.length)].name;
                if (randomMed !== currentPatient.correctMedicine && !chosenMedicines.has(randomMed)) {
                    chosenMedicines.add(randomMed);
                }
            }

            let finalMedicineOptions = Array.from(chosenMedicines);
            shuffleArray(finalMedicineOptions);
            renderMedicineButtons(finalMedicineOptions);
        }

        // --- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 5: ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏∏‡πà‡∏° (Rendering Functions) ---
        function renderMedicineButtons(medicines) {
            medicineOptionsElem.innerHTML = '';
            medicines.forEach(medicine => {
                const button = document.createElement('button');
                button.classList.add('medicine-button');
                button.textContent = medicine;
                button.onclick = () => selectMedicine(medicine);
                medicineOptionsElem.appendChild(button);
            });
        }

        // ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á renderActionButtons ‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏∏‡πà‡∏°‡∏ï‡∏≤‡∏° currentProcedure
        function renderActionButtons() {
            actionButtonsElem.innerHTML = '';
            actionButtonsElem.style.display = 'flex';
            medicineOptionsElem.style.display = 'none';
            injectionMethodOptionsElem.style.display = 'none';

            let buttonsToRender = currentProcedure.filter(step => step.id !== 'selectInjectionMethod');
            shuffleArray(buttonsToRender); // ‡∏™‡∏•‡∏±‡∏ö‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°

            buttonsToRender.forEach(btn => {
                const button = document.createElement('button');
                button.classList.add('action-button', btn.class);
                button.textContent = btn.text;
                button.onclick = () => handleActionStep(btn.id);
                actionButtonsElem.appendChild(button);
            });
        }

        function renderInjectionMethodButtons() {
            injectionMethodOptionsElem.innerHTML = '';
            injectionMethodOptionsElem.style.display = 'flex';
            actionButtonsElem.style.display = 'none'; // ‡∏ã‡πà‡∏≠‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥

            let buttons = [
                { id: 'intramuscular', text: '‡∏â‡∏µ‡∏î‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏•‡πâ‡∏≤‡∏° (IM)', class: 'intramuscular' },
                { id: 'intravenous', text: '‡∏â‡∏µ‡∏î‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏™‡πâ‡∏ô (IV)', class: 'intravenous' },
                { id: 'subcutaneous', text: '‡∏â‡∏µ‡∏î‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ï‡πâ‡∏ú‡∏¥‡∏ß‡∏´‡∏ô‡∏±‡∏á (SC)', class: 'subcutaneous' },
                { id: 'intradermal', text: '‡∏â‡∏µ‡∏î‡πÄ‡∏Ç‡πâ‡∏≤‡∏ú‡∏¥‡∏ß‡∏´‡∏ô‡∏±‡∏á (ID)', class: 'intradermal' }
            ];
            shuffleArray(buttons);

            buttons.forEach(btn => {
                const button = document.createElement('button');
                button.classList.add('injection-method-button', btn.class);
                button.textContent = btn.text;
                button.onclick = () => handleInjectionMethod(btn.id);
                injectionMethodOptionsElem.appendChild(button);
            });
        }

        // --- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 6: Logic ‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏° (Game Logic) ---
        function selectMedicine(selectedMedicine) {
            medicineOptionsElem.style.pointerEvents = 'none';

            if (selectedMedicine === currentPatient.correctMedicine) {
                feedbackElem.textContent = `‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏¢‡∏≤ "${selectedMedicine}" ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!`;
                feedbackElem.classList.remove('incorrect');
                feedbackElem.classList.add('correct');

                // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡∏≠‡∏á‡∏¢‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
                currentProcedure = correctProcedures[currentPatient.medicineType];
                currentStepIndex = 0; // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á procedure ‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å

                // ‡πÅ‡∏à‡πâ‡∏á‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡πÅ‡∏£‡∏Å
                feedbackElem.textContent += ` ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡πÅ‡∏£‡∏Å: "${getActionText(currentProcedure[currentStepIndex].id)}"` || '';

                // ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏°‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô selectInjectionMethod)
                renderActionButtons();
            } else {
                handleWrongAttempt(`‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏¢‡∏≤ "${selectedMedicine}" ‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î! üò• (‡∏¢‡∏≤‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á: ${currentPatient.correctMedicine})`, 10);
            }
        }

        function handleActionStep(actionId) {
            if (!currentProcedure || currentProcedure.length === 0 || currentStepIndex >= currentProcedure.length) {
                handleWrongAttempt('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡πÄ‡∏Å‡∏° ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà', 0);
                return;
            }

            const expectedStep = currentProcedure[currentStepIndex];

            if (actionId === expectedStep.id) {
                feedbackElem.textContent = `‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á! ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ "${getActionText(actionId)}" ‡πÅ‡∏•‡πâ‡∏ß!`;
                feedbackElem.classList.remove('incorrect');
                feedbackElem.classList.add('correct');
                currentStepIndex++;

                if (actionId === 'injectMedicine' && currentPatient.medicineType === 'injection') {
                    // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏â‡∏µ‡∏î‡∏¢‡∏≤ (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏¢‡∏≤‡∏â‡∏µ‡∏î) ‡πÉ‡∏´‡πâ‡πÑ‡∏õ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏â‡∏µ‡∏î
                    feedbackElem.textContent += ` ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏â‡∏µ‡∏î:`;
                    renderInjectionMethodButtons();
                } else if (currentStepIndex < currentProcedure.length) {
                    // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ
                    const nextExpectedStep = currentProcedure[currentStepIndex];
                    if (nextExpectedStep.id === 'selectInjectionMethod') {
                        // ‡∏Å‡∏£‡∏ì‡∏µ‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ injectMedicine ‡∏à‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏Å renderInjectionMethodButtons ‡πÅ‡∏•‡πâ‡∏ß
                        // ‡πÅ‡∏ï‡πà‡πÉ‡∏™‡πà‡πÑ‡∏ß‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢
                        feedbackElem.textContent += ` ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏â‡∏µ‡∏î:`;
                        renderInjectionMethodButtons();
                    } else {
                        feedbackElem.textContent += ` ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ: "${getActionText(nextExpectedStep.id)}"`;
                        renderActionButtons(); // ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏°‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠ (‡∏™‡∏∏‡πà‡∏°‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á)
                    }
                } else {
                    // ‡∏ó‡∏≥‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡∏¢‡∏≤‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏¢‡∏≤‡∏â‡∏µ‡∏î ‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏≤‡∏â‡∏µ‡∏î‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏°‡∏µ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏â‡∏µ‡∏î‡πÅ‡∏¢‡∏Å
                    finishPatientCare();
                }
            } else {
                handleWrongAttempt(`‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ú‡∏¥‡∏î! ‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏ß‡∏£‡∏à‡∏∞‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ "${getActionText(expectedStep.id)}"`, 5);
            }
        }

        function handleInjectionMethod(methodId) {
            if (methodId === currentPatient.correctInjectionMethod) {
                feedbackElem.textContent = `‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á! ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ "${getActionText(methodId)}" ‡πÅ‡∏•‡πâ‡∏ß! ‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏´‡∏≤‡∏¢‡∏î‡∏µ‡πÅ‡∏•‡πâ‡∏ß üòä`;
                feedbackElem.classList.remove('incorrect');
                feedbackElem.classList.add('correct');
                finishPatientCare();
            } else {
                handleWrongAttempt(`‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏â‡∏µ‡∏î‡∏ú‡∏¥‡∏î! ‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏ß‡∏£‡∏à‡∏∞‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ "${getActionText(currentPatient.correctInjectionMethod)}"`, 5);
            }
        }

        function finishPatientCare() {
            score += 10;
            scoreDisplayElem.textContent = `‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: ${score}`;
            nextPatientBtn.style.display = 'block';
            actionButtonsElem.style.display = 'none';
            injectionMethodOptionsElem.style.display = 'none';
            medicineOptionsElem.style.display = 'none'; // ‡∏ã‡πà‡∏≠‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏¢‡∏≤‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß
        }

        // --- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 7: ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏Å‡∏° ---
        nextPatientBtn.addEventListener('click', loadNewPatient);
        startGame();
    </script>
</body>
</html>